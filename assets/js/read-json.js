(function(){var e,n,t,s;$(".sidebar").mCustomScrollbar({mouseWheel:{deltaFactor:100},autoHideScrollbar:!0}),s="data/",t="general/",e=new Vue({el:"#channelList",data:{channels:[]},methods:{onClick:function(e){return n.channel.name=e.target.innerHTML.slice(1),console.log("channel switched : "+n.channel.name)},onLoad:function(){return n.channel.name=this.channels[0].name,console.log("channel onLoad : "+n.channel.name)},updateChannelList:function(){return $.getJSON(s+"channels.json",function(n){var t,s,a;for(t=0,s=n.length;s>t;t++)a=n[t],e.channels.push(a);return e.onLoad()})}},created:function(){return console.log("channelList created"),this.updateChannelList()}}),n=new Vue({el:"#channelMassages",data:{channel:{name:""},massages:[],massages_updated:[],fileList:[],fileListNum:0,userData:[],loadMessage:!1},methods:{updateUserData:function(){var e;if(!(this.userData.length>0))return e=s+"users.json",console.log("load user data : "+e),$.ajax({type:"GET",url:e,async:!1}).done(function(e){return n.$set("userData",e)}),console.log("update user data done")},updateFileList:function(e){var t;return t=s+e+"/filelist.json",console.log("load channel filelist : "+t),$.ajax({type:"GET",url:t,async:!1}).done(function(e){return n.$set("fileList",e)}),console.log("update channel filelist done")},updateChannelMassages:function(e){var t;return console.log("update channel messages"),console.log("fileList.length : "+this.fileList.length),t=s+e+"/"+this.fileList[this.fileListNum],console.log("load json data : "+t),$.ajax({type:"GET",url:t,async:!1}).done(function(e){var t,s,a,o,i,l,u,r,c,d,h,m,g;for(c=[],s=0,i=e.length;i>s;s++){if(r=e[s],void 0===r.icons&&(void 0===r.user?r.icons={image_48:"assets/icon/dummy.png"}:n.userData.filter(function(e,n){return e.id===r.user?r.icons={image_48:e.profile.image_48}:void 0})),void 0===r.username&&(void 0===r.user?r.username="unknown":n.userData.filter(function(e,n){return e.id===r.user&&void 0!==e.name?r.username=e.name:void 0})),m=String(r.ts).split(".")[0],r.fixedTimestamp=moment.unix(m).format("YYYY/MM/DD hh:mm"),r.textFixed=marked(r.text),void 0!==r.attachments)for(d=r.attachments,a=0,l=d.length;l>a;a++)t=d[a],t.textFixed=marked(t.text);c.push(r)}for(h=[],o=0,u=c.length;u>o;o++)g=c[o],h.push(n.massages.push(g));return h}),this.$set("massages_updated",this.massages),console.log("update channel messages done")},onChangeChannel:function(){return this.$set("massages",[]),this.$set("massages_updated",[]),this.updateUserData(),this.updateFileList(this.channel.name),this.updateMessages(),this.tryUpdateMessages()},updateMessages:function(){return this.fileListNum<=this.fileList.length?(this.updateChannelMassages(this.channel.name),this.fileListNum++,console.log("fileListNum: "+this.fileListNum)):void 0},tryUpdateMessages:function(){var e;for(e=[];this.checkNeedLoad()===!0&&this.fileListNum<=this.fileList.length;)this.updateChannelMassages(this.channel.name),this.fileListNum++,e.push(console.log("fileListNum: "+this.fileListNum));return e},checkNeedLoad:function(){var e,n,t;return t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.offsetHeight||document.body.offsetHeight,e=document.documentElement.scrollHeight||document.body.scrollHeight,t+n>=e}},watch:{"channel.name":function(){return this.onChangeChannel()},massages:function(){return console.log("massages updated")},loadMessage:function(){return console.log("loadMessage: "+this.loadMessage),this.loadMessage===!0?this.tryUpdateMessages():void 0}},created:function(){return console.log("channelMassages created")}}),document.onscroll=function(){return n.loadMessage=n.checkNeedLoad()}}).call(this);